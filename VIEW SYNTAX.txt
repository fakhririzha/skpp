CREATE OR REPLACE VIEW vSiswaKelas AS
SELECT s.sttb, s.nama, s.kode_kelas, s.status, k.semester, k.tahun_akademik, k.iuran_bulanan, k.iuran_bulanan_subsidi, k.iuran_tahunan FROM siswa s LEFT JOIN kelas k ON s.kode_kelas = k.kode_kelas;

CREATE OR REPLACE VIEW vHistoriTransaksi AS
SELECT t.*, u.nama FROM transaksi t, user u WHERE t.id_petugas = u.id;

CREATE OR REPLACE VIEW vHistoriTransaksiBulanan AS
SELECT (s.nama) AS namaSiswa, (s.sttb) AS sttbSiswa, b.* FROM bulanan b, siswa s WHERE s.sttb = b.sttb;

CREATE OR REPLACE VIEW vHistoriTransaksiTahunan AS
SELECT (s.nama) AS namaSiswa, (s.sttb) AS sttbSiswa, b.* FROM tahunan b, siswa s WHERE s.sttb = b.sttb;

CREATE OR REPLACE VIEW vPenerimaanPutra AS
SELECT tanggal, (SUM(nominal)) AS penerimaanPutra FROM transaksi WHERE kode = '1A' GROUP BY tanggal;

CREATE OR REPLACE VIEW vPenerimaanPutri AS
SELECT tanggal, (SUM(nominal)) AS penerimaanPutra FROM transaksi WHERE kode = '2A' GROUP BY tanggal;

CREATE OR REPLACE VIEW vLaporanSPP AS
SELECT
    DATE_FORMAT(`skpp`.`transaksi`.`tanggal`, '%d/%m/%Y') AS `tanggalFormatted`,
    `skpp`.`transaksi`.`tanggal` AS `tanggal`,
    `penerimaanSPP`(`skpp`.`transaksi`.`nominal`, `skpp`.`transaksi`.`kode`, 'Putra') AS `putra`,
    `penerimaanSPP`(`skpp`.`transaksi`.`nominal`, `skpp`.`transaksi`.`kode`, 'Putri') AS `putri`,
    SUM((SELECT `putra`)) AS `jlhPutra`,
    SUM((SELECT `putri`)) AS `jlhPutri`,
    SUM(((SELECT `putra`)+(SELECT `putri`))) AS `jumlah`
FROM
    `skpp`.`transaksi`
WHERE
    ((`skpp`.`transaksi`.`kode` = '1A') OR(`skpp`.`transaksi`.`kode` = '2A'))
GROUP BY
    `skpp`.`transaksi`.`tanggal`
